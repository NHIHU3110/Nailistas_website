<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ÄÄƒng nháº­p â€“ Nailistas Viá»‡t Nam</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../Login/style.css">
</head>
<body>
  <header>
    <div class="nav-left">
      <a href="../Blog/Blog.html" data-transition>Blog</a>
      <a href="../Booking/Booking.html" data-transition>Äáº·t lá»‹ch</a>
      <a href="../Product/html/Product.html" data-transition>Sáº£n pháº©m</a>
      <a href="../Service/service.html" data-transition>Dá»‹ch vá»¥</a>
    </div>
  
    <div class="logo-center">
      <img src="../images/nail logo-01.png" alt="Logo Nailistas" onclick="goHome()">
    </div>
  
    <div class="nav-right">
      <a href="../contact/contact.html" data-transition>LiÃªn há»‡</a>
      <a href="../Login/login.html" data-transition>ÄÄƒng nháº­p</a>
      <a href="#" id="cart-link">Giá» hÃ ng <span id="cart-count" class="badge">0</span></a>
      <a href="#" data-auth="logout" style="display: none;" onclick="logout(); return false;">ÄÄƒng xuáº¥t</a>
      <a href="../Personal/personal.html" data-transition class="account-link">
        
        <div class="account-avatar" style="display:none;"></div>
      </a>
      
    </div>
  </header>
  
  <main>
  <div class="login-container">
    <div class="login-image">
      <img src="../images/nail logo-01.png" alt="Logo Nailistas">
      <h1>ChÃ o má»«ng trá»Ÿ láº¡i</h1>
      <p>Tráº£i nghiá»‡m dá»‹ch vá»¥ lÃ m Ä‘áº¹p chuyÃªn nghiá»‡p vÃ  sáº£n pháº©m chÄƒm sÃ³c mÃ³ng cao cáº¥p.</p>
    </div>

    <div class="login-form">
      <h2>ÄÄƒng nháº­p</h2>
      <form id="form-login" novalidate>
        <label>
          Email
          <input type="email" id="login-email" placeholder="you@example.com" required>
          <div class="error" id="login-email-err"></div>
        </label>

        <label class="field-suffix">
          Máº­t kháº©u
          <input type="password" id="login-password" placeholder="Nháº­p máº­t kháº©u cá»§a báº¡n" required>
          <button class="toggle-eye" type="button" data-for="login-password" aria-label="Hiá»ƒn/áº©n máº­t kháº©u"></button>
          <div class="error" id="login-password-err"></div>
        </label>

        <div class="actions">
          <label class="remember">
            <input type="checkbox" id="remember-me"> Ghi nhá»› Ä‘Äƒng nháº­p
          </label>
          <a href="#" class="forgot">QuÃªn máº­t kháº©u?</a>
        </div>

        <button class="btn" type="submit">ÄÄƒng nháº­p</button>
        <div class="error" id="login-general"></div>
        <p class="footer-form">
          ChÆ°a cÃ³ tÃ i khoáº£n? <a href="../Login/signup.html">ÄÄƒng kÃ½ ngay</a>
        </p>
      </form>
    </div>
  </div>
</main>


  <!-- Transition overlay -->
  <div id="transition-overlay">
    <img src="../images/nail logo-01.png" alt="Logo chuyá»ƒn trang">
  </div>

  <footer>
    <div class="footer-container">
      <div class="footer-section"><h3>Há»‡ thá»‘ng chi nhÃ¡nh</h3><p>ğŸ“ 12 Nguyá»…n Huá»‡, Quáº­n 1, TP.HCM</p><p>ğŸ“ 25 LÃ½ ThÆ°Æ¡ng Kiá»‡t, HÃ  Ná»™i</p><p>ğŸ“ 08 Báº¡ch Äáº±ng, ÄÃ  Náºµng</p></div>
      <div class="footer-section"><h3>LiÃªn há»‡</h3><p>ğŸ“ Hotline: <strong>0909 888 777</strong></p><p>ğŸ“§ Email: <a href="mailto:contact@nailistas.vn">contact@nailistas.vn</a></p></div>
      <div class="footer-section"><h3>ChÃ­nh sÃ¡ch</h3><p><a href="#">ChÃ­nh sÃ¡ch báº£o máº­t</a></p><p><a href="#">Äiá»u khoáº£n dá»‹ch vá»¥</a></p></div>
    </div>
    <hr>
    <p>&copy; Nailistas Viá»‡t Nam</p>
  </footer>

  <div id="confetti-container"></div>

<!-- Gá»i auth.js trÆ°á»›c Ä‘á»ƒ Ä‘áº£m báº£o AuthUtils sáºµn sÃ ng -->
<script src="auth.js"></script>

<script>

    const Auth = window.AuthUtils;
    try { Auth.initToggleEye && Auth.initToggleEye(); } catch {}
    
    window.addEventListener("DOMContentLoaded", () => {
      const pending = sessionStorage.getItem("sv_pending_email");
      const saved = localStorage.getItem("sv_last_email");
      if (pending) {
        document.getElementById("login-email").value = pending;
        document.getElementById("remember-me").checked = true;
        sessionStorage.removeItem("sv_pending_email");
      } else if (saved) {
        document.getElementById("login-email").value = saved;
        document.getElementById("remember-me").checked = true;
      }
    })

    document.getElementById("form-login").addEventListener("submit", (e) => {
      e.preventDefault();
      ["login-email-err","login-password-err","login-general"].forEach(id => { 
        const el=document.getElementById(id); 
        if(el) el.textContent=""; 
      });

      const email = document.getElementById("login-email").value.trim().toLowerCase();
      const pw = document.getElementById("login-password").value;

      if(!Auth.emailRe.test(email)){
        document.getElementById("login-email-err").textContent = "Vui lÃ²ng nháº­p Ä‘á»‹a chá»‰ email há»£p lá»‡";
        return;
      }
      if(!pw){
        document.getElementById("login-password-err").textContent = "Vui lÃ²ng nháº­p máº­t kháº©u";
        return;
      }

      const users = Auth.loadUsers();
      const digest = Auth.hashPassword(pw);
      const user = users.find(u => u.email === email && u.pw === digest);

      if(!user){
        document.getElementById("login-general").textContent = "Email hoáº·c máº­t kháº©u khÃ´ng chÃ­nh xÃ¡c. Vui lÃ²ng thá»­ láº¡i.";
        return;
      }

      if(document.getElementById("remember-me").checked){
        localStorage.setItem("sv_last_email", email);
      } else {
        localStorage.removeItem("sv_last_email");
      }

      Auth.setCurrentUser(user);

// Trong hÃ m login thÃ nh cÃ´ng:
// Trong hÃ m login thÃ nh cÃ´ng
Auth.setCurrentUser(user);

// Hoa há»“ng rÆ¡i
launchRosePetals(80);

// Xá»­ lÃ½ Ä‘iá»u hÆ°á»›ng
if (user.role === 'admin') {
  const goAdmin = confirm("Báº¡n Ä‘Äƒng nháº­p báº±ng tÃ i khoáº£n Admin.\nOK = vÃ o Admin Dashboard. Cancel = vÃ o Trang chá»§.");
  if (goAdmin) {
    setTimeout(() => {
      window.location.href = "../Admin/admin.html";
    }, 1200);
  } else {
    setTimeout(goHome, 1200);
  }
} else {
  setTimeout(goHome, 1200);
}



    });
  </script>

  <script>
    (async function importUsersFromJsonOnce(){
      const FLAG = 'sv_users_imported';
      if(localStorage.getItem(FLAG)) return;
      try{
        const res = await fetch('../Login/users.json');
        if(!res.ok) return;
        const raw = await res.json();
        const Auth = window.AuthUtils;
        const existing = Auth.loadUsers();
        const map = new Map(existing.map(u => [u.email, u]));
        raw.forEach(u => {
          if(!u?.email) return;
          const hashed = (u.pw && u.pw.length < 20) ? Auth.hashPassword(u.pw) : u.pw;
          map.set(u.email.toLowerCase(), {
            name: u.name || '',
            email: u.email.toLowerCase(),
            pw: hashed,
            role: u.role || 'user',
            createdAt: u.createdAt || Date.now()
          });
        });
        const merged = Array.from(map.values());
        Auth.saveUsers(merged);
        localStorage.setItem(FLAG, '1');
        console.log('Imported users.json');
      }catch(e){ console.warn('Import users.json failed', e); }
    })();
  </script>

  <script>
    (function seedAdminFix(){
      const Auth = window.AuthUtils;
      if(!Auth) return;
      const users = Auth.loadUsers();
      const email = 'admin@gmail.com';
      const pass  = 'Admin@123';
      if (!users.some(u => u.email === email)) {
        users.push({
          name: "Admin Nailistas",
          email,
          pw: Auth.hashPassword(pass),
          role: "admin",
          createdAt: Date.now()
        });
        Auth.saveUsers(users);
        console.log('ÄÃ£ táº¡o tÃ i khoáº£n admin');
      } else {
        console.log('âš™ï¸ Admin Ä‘Ã£ tá»“n táº¡i');
      }
    })();
  </script>

</body>
</html>